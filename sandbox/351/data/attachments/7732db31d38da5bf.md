# Test info

- Name: MLS Global Settings Test - User: Client-Engage-2-Existing >> Should update MLS Custom Display name and verify it on front-end search page - User: Client-Engage-2-Existing
- Location: /opt/atlassian/pipelines/agent/build/src/tests/specs/clients/06_design/04_settings/03_mls/mlsGlobalSettings.spec.ts:11:13

# Error details

```
TimeoutError: locator.dblclick: Timeout 20000ms exceeded.
Call log:
  - waiting for locator('tr#mls-a411').locator('td.editable')
    - locator resolved to <td class=" editable">MLS Display 1748750653186</td>
  - attempting dblclick action
    2 × waiting for element to be visible, enabled and stable
      - element is not visible
    - retrying dblclick action
    - waiting 20ms
    2 × waiting for element to be visible, enabled and stable
      - element is not visible
    - retrying dblclick action
      - waiting 100ms
    38 × waiting for element to be visible, enabled and stable
       - element is not visible
     - retrying dblclick action
       - waiting 500ms

    at MlsSettingsPage.clickCustomDisplayEdit (/opt/atlassian/pipelines/agent/build/src/page-objects/client/06_design/04_settings/03_mls/MlsSettingsPage.ts:117:20)
    at MlsSettingsPage.editCustomDisplay (/opt/atlassian/pipelines/agent/build/src/page-objects/client/06_design/04_settings/03_mls/MlsSettingsPage.ts:154:20)
    at /opt/atlassian/pipelines/agent/build/src/tests/specs/clients/06_design/04_settings/03_mls/mlsGlobalSettings.spec.ts:25:42
```

# Page snapshot

```yaml
- navigation:
  - link "IDX Broker":
    - /url: /mgmt/dashboard
    - img "IDX Broker"
  - list:
    - listitem
- text: Notifications
- strong: You’re all caught up! Keep an eye out for new notifications. We’ll post them here.
- navigation:
  - list:
    - listitem
    - listitem
    - listitem
- paragraph:
  - text: Services © 2025
  - link "IDX Broker":
    - /url: https://www.idxbroker.com
  - text: . All rights reserved.
- status
- status
```

# Test source

```ts
   17 |     readonly mlsRow: Locator;
   18 |     // Property type visibility checkbox locators
   19 |     readonly propertyTypeVisibilityCheckbox: Locator;
   20 |     readonly visibilityColumnCell: Locator;
   21 |     readonly propertyTypeRow: Locator;
   22 |     // CSS selector for specific checkbox targeting (used due to complex table structure)
   23 |     readonly disabledPropTypesInput: Locator;
   24 |     // Loading indicator for property types table
   25 |     readonly propertyTypeTableLoading: Locator;
   26 |
   27 |     // Property type name to value mapping
   28 |     // This maps property type display names to their corresponding checkbox values
   29 |     private readonly propertyTypeValueMap: Record<string, string> = {
   30 |         'Residential': '1',
   31 |         'Commercial Sale': '3',
   32 |         'Multi Family': '5',
   33 |         'Land': '4',
   34 |     };
   35 |
   36 |     /**
   37 |      * Constructor for MlsSettingsPage
   38 |      * @param page - Playwright page object
   39 |      */
   40 |     constructor(page: Page) {
   41 |         super(page);
   42 |         
   43 |         // Initialize locators
   44 |         this.mlsTable = page.locator('#mlsTable');
   45 |         // Input field appears after clicking edit
   46 |         this.customDisplayInput = page.locator('input[name="value"]');
   47 |         this.propertyTypesTab = page.getByRole('link', { name: 'Property Types' });
   48 |         this.propertyTypeTable = page.locator('#propTypeTable');
   49 |         this.propertyTypeCell = page.locator('td.propertyType');
   50 |         this.rowCell = page.getByRole('cell');
   51 |         this.tableHeader = this.mlsTable.locator('thead');
   52 |         this.tableHeaderCells = this.tableHeader.locator('th');
   53 |         this.mlsRow = page.locator('tr[id^="mls-"]');
   54 |         // Initialize role-based locators
   55 |         this.propertyTypeVisibilityCheckbox = page.getByRole('checkbox');
   56 |         this.propertyTypeRow = page.getByRole('row');
   57 |         this.visibilityColumnCell = page.locator('td.text-center');
   58 |         // CSS selector for reliable checkbox targeting in complex table structure
   59 |         this.disabledPropTypesInput = page.locator('input[name="disabledPropTypes"]');
   60 |         // Loading indicator locator
   61 |         this.propertyTypeTableLoading = page.locator('#propTypeTable_processing');
   62 |     }
   63 |
   64 |     /**
   65 |      * Get the index of a column based on its header text.
   66 |      * @param headerText - The text of the header to find.
   67 |      * @returns Promise resolving to the 0-based index of the column.
   68 |      * @throws Error if the header is not found.
   69 |      */
   70 |     private async getColumnIndexByHeaderText(headerText: string): Promise<number> {
   71 |         const count = await this.tableHeaderCells.count();
   72 |         for (let i = 0; i < count; i++) {
   73 |             const text = await this.tableHeaderCells.nth(i).textContent();
   74 |             if (text?.trim() === headerText) {
   75 |                 return i;
   76 |             }
   77 |         }
   78 |         throw new Error(`Header with text "${headerText}" not found.`);
   79 |     }
   80 |
   81 |     /**
   82 |      * Get the locator for a specific row using its ID attribute.
   83 |      * @param mlsId - The MLS ID used in the row's ID (e.g., 'a411').
   84 |      * @returns Locator for the table row.
   85 |      */
   86 |     private getRowByMlsId(mlsId: string): Locator {
   87 |         // Use the specific ID of the row
   88 |         return this.page.locator(`tr#mls-${mlsId}`);
   89 |     }
   90 |
   91 |     /**
   92 |      * Get the locator for the Custom Display cell for a given MLS ID.
   93 |      * Uses the 'editable' class specific to this column within the row identified by ID.
   94 |      * @param mlsId - The MLS ID of the target row.
   95 |      * @returns Locator for the Custom Display cell.
   96 |      */
   97 |     private getCustomDisplayCell(mlsId: string): Locator {
   98 |         const row = this.getRowByMlsId(mlsId);
   99 |         // Target the cell within the ID'd row that has the 'editable' class
  100 |         return row.locator('td.editable');
  101 |     }
  102 |
  103 |     /**
  104 |      * Navigate to the MLS Settings page.
  105 |      */
  106 |     async goto(): Promise<void> {
  107 |         await this.page.goto(`${this.globalAndEnvironmentVariables.MW_BASE_URL}/mgmt/mls-settings`);
  108 |         await waitForPageToBeFullyLoaded(this.page);
  109 |     }
  110 |
  111 |     /**
  112 |      * Double-clicks the Custom Display cell to make it editable.
  113 |      * @param mlsId - The MLS ID of the target row (e.g., 'a411').
  114 |      */
  115 |     async clickCustomDisplayEdit(mlsId: string): Promise<void> {
  116 |         const cell = this.getCustomDisplayCell(mlsId);
> 117 |         await cell.dblclick();
      |                    ^ TimeoutError: locator.dblclick: Timeout 20000ms exceeded.
  118 |     }
  119 |
  120 |     /**
  121 |      * Set a new value for the Custom Display field for a specific MLS row.
  122 |      * Assumes the edit mode is active (cell was double-clicked).
  123 |      * @param mlsId - The MLS ID of the target row.
  124 |      * @param value - The new value to set.
  125 |      */
  126 |     async setCustomDisplayValue(mlsId: string, value: string): Promise<void> {
  127 |         // Wait for the input field to appear after double-click
  128 |         await this.customDisplayInput.waitFor({ state: 'visible', timeout: 5000 });
  129 |         await this.customDisplayInput.fill(value);
  130 |         await this.customDisplayInput.press('Enter');
  131 |         // Wait for the value to be saved by checking the specific cell
  132 |         const cell = this.getCustomDisplayCell(mlsId);
  133 |         // Add a small wait for the text update to propagate after Enter press
  134 |         await this.page.waitForTimeout(500);
  135 |         await expect(cell).toContainText(value, { timeout: 10000 });
  136 |     }
  137 |
  138 |     /**
  139 |      * Get the current Custom Display value for a specific MLS row.
  140 |      * @param mlsId - The MLS ID of the target row.
  141 |      * @returns Promise resolving to the current custom display value.
  142 |      */
  143 |     async getCustomDisplayValue(mlsId: string): Promise<string> {
  144 |         const cell = this.getCustomDisplayCell(mlsId);
  145 |         return await cell.textContent() || '';
  146 |     }
  147 |
  148 |     /**
  149 |      * Edit the Custom Display value for a specific MLS row.
  150 |      * @param mlsId - The MLS ID of the target row (e.g., 'a411').
  151 |      * @param newValue - The new value to set for Custom Display.
  152 |      */
  153 |     async editCustomDisplay(mlsId: string, newValue: string): Promise<void> {
  154 |         await this.clickCustomDisplayEdit(mlsId);
  155 |         // Pass mlsId to setCustomDisplayValue
  156 |         await this.setCustomDisplayValue(mlsId, newValue);
  157 |     }
  158 |
  159 |     async dragRowToTargetRow(sourceRowDomId: string, targetRowDomId: string): Promise<void> {
  160 |         const sourceCell = this.rowCell.filter({ hasText: sourceRowDomId }).nth(1);
  161 |         const targetCell = this.rowCell.filter({ hasText: targetRowDomId }).nth(1);
  162 |         
  163 |         await sourceCell.dragTo(targetCell);
  164 |         
  165 |         await this.page.waitForTimeout(1000);
  166 |     }
  167 |
  168 |     /**
  169 |      * Wait for the property types table to finish loading
  170 |      * Waits for the DataTables loading indicator to disappear
  171 |      */
  172 |     async waitForPropertyTypeTableToLoad(): Promise<void> {
  173 |         // Wait for the loading indicator to become hidden
  174 |         await this.propertyTypeTableLoading.waitFor({ state: 'hidden', timeout: 10000 });
  175 |     }
  176 |
  177 |     /**
  178 |      * Clicks on the "Property Types" tab and waits for the table to load.
  179 |      * 
  180 |      */
  181 |     async goToPropertyTypesTab(): Promise<void> {
  182 |         // Using the role-based locator (or another Playwright-specific one)
  183 |         await this.propertyTypesTab.click();
  184 |         await waitForPageToBeFullyLoaded(this.page);
  185 |         // Wait for the DataTables loading to complete
  186 |         await this.waitForPropertyTypeTableToLoad();
  187 |     }
  188 |
  189 |     // Inside PropertyTypesPage class
  190 |     async getPropertyTypeByRow(rowNumber: number): Promise<string> {
  191 |         const textContent = await this.propertyTypeTable
  192 |             .locator(`tbody tr:nth-child(${rowNumber})`)
  193 |             .locator(this.propertyTypeCell)
  194 |             .textContent();
  195 |         return (textContent || '').trim();
  196 |     }
  197 |
  198 |     /**
  199 |      * Get the total count of property type rows in the table
  200 |      * @returns Promise<number> - The number of property type data rows
  201 |      */
  202 |     async getPropertyTypeRowCount(): Promise<number> {
  203 |         // Count rows in the tbody (excludes header rows)
  204 |         return await this.propertyTypeTable.locator('tbody tr').count();
  205 |     }
  206 |
  207 |     /**
  208 |      * Get the visibility checkbox locator for a specific property type using its value
  209 |      * @param propertyTypeName - The name of the property type
  210 |      * @returns Locator for the visibility checkbox
  211 |      * @throws Error if property type name is not found in the mapping
  212 |      */
  213 |     private getPropertyTypeVisibilityCheckbox(propertyTypeName: string): Locator {
  214 |         const value = this.propertyTypeValueMap[propertyTypeName];
  215 |         if (!value) {
  216 |             throw new Error(`Property type "${propertyTypeName}" not found in mapping. Available types: ${Object.keys(this.propertyTypeValueMap).join(', ')}`);
  217 |         }
```