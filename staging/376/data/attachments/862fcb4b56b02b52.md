# Test info

- Name: Run these test in serial mode for each user >> Create Agent - User: Client-Engage-1-Existing
- Location: /opt/atlassian/pipelines/agent/build/src/tests/specs/clients/07_account/04_users/agents.spec.ts:16:13

# Error details

```
Error: expect.toBeVisible: Error: strict mode violation: locator('tr:has(td:text-is("idxqamv+1749243536345@gmail.com"))') resolved to 2 elements:
    1) <tr class="odd" id="rowID-37142">…</tr> aka getByRole('row', { name: 'Qa UiAutomation 37142 idxqamv' })
    2) <tr class="even" id="rowID-37144">…</tr> aka getByRole('row', { name: 'Qa UiAutomation 37144 idxqamv' })

Call log:
  - expect.toBeVisible with timeout 20000ms
  - waiting for locator('tr:has(td:text-is("idxqamv+1749243536345@gmail.com"))')

    at ManageAgentsPage.verifyAgentExistsByEmail (/opt/atlassian/pipelines/agent/build/src/page-objects/client/07_account/04_users/ManageAgentsPage.ts:78:32)
    at /opt/atlassian/pipelines/agent/build/src/tests/specs/clients/07_account/04_users/agents.spec.ts:32:13
```

# Page snapshot

```yaml
- navigation:
  - link "IDX Broker":
    - /url: /mgmt/dashboard
    - img "IDX Broker"
  - list:
    - listitem:
      - text: Staging
      - strong: "Signed in as:"
      - text: Nic (3978)
    - listitem:
      - img
- text: Notifications
- strong: You’re all caught up! Keep an eye out for new notifications. We’ll post them here.
- navigation:
  - list:
    - listitem: Home +
    - listitem: Leads +
    - listitem: Listings +
    - listitem: Messages +
    - listitem:
      - link "MLS":
        - /url: /mgmt/mls-membership
    - listitem: Design +
    - listitem: Account -
    - listitem: Support +
- listitem:
  - link "Page Help":
    - /url: "#"
- heading "Agents manage your agents" [level=1]
- link "Add Agent":
  - /url: /mgmt/agents/create
- link "Import":
  - /url: /mgmt/agents/import
- link "Export":
  - /url: /mgmt/users/exports/create
- link "Set Global Permissions":
  - /url: "#globalPermissions"
- grid:
  - text: Show
  - combobox "Show entries":
    - option "10" [selected]
    - option "25"
    - option "50"
    - option "100"
  - text: "entries Search:"
  - 'textbox "Search: ? "': idxqamv+1749243536345@gmail.com
  - link "?":
    - /url: "#"
  - link "":
    - /url: "#"
  - table:
    - rowgroup:
      - 'row "First Name: activate to sort column ascending Last Name: activate to sort column descending User ID: activate to sort column ascending Email: activate to sort column ascending Category: activate to sort column ascending Last Login: activate to sort column ascending Tools"':
        - columnheader:
          - checkbox
        - 'columnheader "First Name: activate to sort column ascending"': First Name
        - 'columnheader "Last Name: activate to sort column descending"': Last Name
        - 'columnheader "User ID: activate to sort column ascending"': User ID
        - 'columnheader "Email: activate to sort column ascending"': Email
        - 'columnheader "Category: activate to sort column ascending"': Category
        - 'columnheader "Last Login: activate to sort column ascending"': Last Login
        - columnheader "Tools"
    - alert:
      - row "Qa UiAutomation 37142 idxqamv+1749243536345@gmail.com Agent Never    ":
        - cell:
          - checkbox
        - cell "Qa"
        - cell "UiAutomation"
        - cell "37142"
        - cell "idxqamv+1749243536345@gmail.com"
        - cell "Agent"
        - cell "Never"
        - cell "   ":
          - link "":
            - /url: /mgmt/vlogin/30/3978/37142
          - link "":
            - /url: /mgmt/agents/37142/edit
          - link "":
            - /url: https://testing1210plat.idxstaging.com/idx/agent/37142/qauiautomation
          - text: 
      - row "Qa UiAutomation 37144 idxqamv+1749243536345@gmail.com Agent Never    ":
        - cell:
          - checkbox
        - cell "Qa"
        - cell "UiAutomation"
        - cell "37144"
        - cell "idxqamv+1749243536345@gmail.com"
        - cell "Agent"
        - cell "Never"
        - cell "   ":
          - link "":
            - /url: /mgmt/vlogin/30/3978/37144
          - link "":
            - /url: /mgmt/agents/37144/edit
          - link "":
            - /url: https://testing1210plat.idxstaging.com/idx/agent/37144/qauiautomation
          - text: 
  - text: Showing 1 to 2 of 2 entries
  - list:
    - listitem:
      - link "← Previous":
        - /url: "#"
    - listitem:
      - link "1":
        - /url: "#"
    - listitem:
      - link "Next →":
        - /url: "#"
- paragraph:
  - text: "With selected:"
  - link "Delete Agents":
    - /url: "#bulkActionForm"
- paragraph:
  - text: Services © 2025
  - link "IDX Broker":
    - /url: https://www.idxbroker.com
  - text: . All rights reserved.
```

# Test source

```ts
   1 | import { Page, Locator, expect, BasePage, waitForPageToBeFullyLoaded } from '@shared-client-imports';
   2 |
   3 | /**
   4 |  * ManageAgentsPage class implements the Page Object Model pattern for the Manage Agents page
   5 |  * Provides methods and locators to interact with elements on the page
   6 |  */
   7 | export class ManageAgentsPage extends BasePage {
   8 |     // Table locators
   9 |     readonly agentsTable: Locator;
   10 |     readonly searchInput: Locator;
   11 |     
   12 |     // Action buttons
   13 |     readonly deleteSelectedAgentsButton: Locator;
   14 |     
   15 |     // Checkboxes
   16 |     readonly selectAllCheckbox: Locator;
   17 |
   18 |     // Confirmation dialog elements
   19 |     readonly confirmDialogYesButton: Locator;
   20 |
   21 |     //Messages
   22 |     private readonly successMessage: Locator;
   23 |     private readonly noAgentsMessage: Locator;
   24 |     
   25 |     /**
   26 |      * Constructor - initializes the page object and locators
   27 |      * @param page - Playwright page object
   28 |      */
   29 |     constructor(page: Page) {
   30 |         super(page);
   31 |         
   32 |         // Initialize locators
   33 |         this.agentsTable = page.locator('#agentListTable');
   34 |         this.searchInput = page.getByRole('textbox', { name: 'Search: ?' });
   35 |         
   36 |         // Action buttons
   37 |         this.deleteSelectedAgentsButton = page.getByRole('link', { name: 'Delete Agents' });
   38 |         
   39 |         // Checkboxes
   40 |         this.selectAllCheckbox = page.locator('#checkAll');
   41 |
   42 |         // Confirmation dialog elements
   43 |         this.confirmDialogYesButton = page.getByRole('button', { name: 'Yes' });
   44 |
   45 |         this.successMessage = page.locator('#jGrowl');
   46 |         this.noAgentsMessage = page.getByRole('cell', { name: 'No agents to display.' });
   47 |     }
   48 |     
   49 |     /**
   50 |     * Go directly to the Add Agent page
   51 |     */
   52 |     async goto(){
   53 |         await this.page.goto(this.globalAndEnvironmentVariables.MW_BASE_URL + '/mgmt/agents');
   54 |         await this.page.waitForLoadState('domcontentloaded');
   55 |         // await this.page.waitForLoadState('load');
   56 |         //await waitForPageToBeFullyLoaded(this.page);
   57 |     }
   58 |     
   59 |     /**
   60 |      * Search for an agent by a search term
   61 |      * @param searchTerm - The term to search for (email, name, etc.)
   62 |      */
   63 |     async searchForAgent(searchTerm: string) {
   64 |         await this.searchInput.fill(searchTerm);
   65 |         await this.page.keyboard.press('Enter');
   66 |         await waitForPageToBeFullyLoaded(this.page);
   67 |         // Wait for the search to complete
   68 |         await this.page.waitForTimeout(500); // Small delay to ensure the search is processed
   69 |     }
   70 |     
   71 |     /**
   72 |      * Verify agent exists by email
   73 |      * @param email - Email address to verify
   74 |      */
   75 |     async verifyAgentExistsByEmail(email: string) {
   76 |         await this.searchForAgent(email);
   77 |         const agentRow = this.page.locator(`tr:has(td:text-is("${email}"))`);
>  78 |         await expect(agentRow).toBeVisible();
      |                                ^ Error: expect.toBeVisible: Error: strict mode violation: locator('tr:has(td:text-is("idxqamv+1749243536345@gmail.com"))') resolved to 2 elements:
   79 |         await expect(agentRow).toContainText(email);
   80 |     }
   81 |     
   82 |     /**
   83 |      * Select all agents using the "Select All" checkbox
   84 |      */
   85 |     async selectAllAgents() {
   86 |         await this.selectAllCheckbox.check();
   87 |         // Adding a small delay to ensure all checkboxes are updated
   88 |         await this.page.waitForTimeout(300);
   89 |     }
   90 |
   91 |     /**
   92 |      * Delete selected agents
   93 |      */
   94 |     async deleteSelectedAgents() {
   95 |         await this.deleteSelectedAgentsButton.click();
   96 |         // Assuming there's a confirmation dialog
   97 |         await this.confirmDialogYesButton.click();
   98 |         await waitForPageToBeFullyLoaded(this.page);
   99 |     }
  100 |     
  101 |     /**
  102 |      * Verify a specific success message is shown in the jGrowl notification
  103 |      * @param expectedMessage The expected message text to verify
  104 |      */
  105 |     async verifySuccessMessage(): Promise<void> {
  106 |         // Verify the text matches what we expect
  107 |         await expect(this.successMessage).toContainText('All Agents you selected have been deleted.');
  108 |     }
  109 |
  110 |     /**
  111 |      * Checks if the "No agents to display" message is visible.
  112 |      * @returns {Promise<boolean>} True if the message is visible, false otherwise.
  113 |      */
  114 |     async isNoAgentsMessageVisible(): Promise<boolean> {
  115 |         return await this.noAgentsMessage.isVisible();
  116 |     }
  117 | }
```